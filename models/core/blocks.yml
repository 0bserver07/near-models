version: 2

models:
  - name: blocks
    description: |-
      This table records all the blocks of Near blockchain.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_height

    columns:
      - name: block_height
        description: The `block_id` taken from block headers. The block number that represent the length of the blockchain in blocks.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER
                - FLOAT

      - name: block_timestamp
        description: The `block_timestamp` taken from block headers.  The time when the block was created.
        tests:
          - not_null
          - dbt_expectations.expect_row_values_to_have_recent_data:
              datepart: day
              interval: 1
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - TIMESTAMP_NTZ

      - name: block_hash
        description: The `block_hash` taken from block headers. A unique identifier for that block.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: tx_count
        description: The `tx_count` taken from block headers. The number of transactions included in the block.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: block_author
        description: The `block_author` taken from block headers. Validators of the blockchain.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: block_challenges_result
        description: The block_challenges_result taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - ARRAY

      - name: block_challenges_root
        description: The block_challenges_root taken from block headers. TODO check this column expectation, number?
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: chunk_headers_root
        description: The chunk_headers_root taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: chunk_mask
        description: The chunk_mask taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - ARRAY

      - name: chunk_receipts_root
        description: The chunk_receipts_root taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: chunk_tx_root
        description: The chunk_tx_root taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: chunks
        description: The chunks taken from block headers. Chunk is an aggregation of transactions which are executed within a particular shard.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - ARRAY

      - name: chunks_included
        description: The chunks_included taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: epoch_id
        description: The epoch_id taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: epoch_sync_data_hash
        description: The epoch_sync_data_hash taken from block headers.
        tests:
          - not_null

      - name: events
        description: The events taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - ARRAY

      - name: gas_price
        description: The gas_price taken from block headers, number is not decimal adjusted.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: last_ds_final_block
        description: The last_ds_final_block taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: last_final_block
        description: The last_final_block taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: latest_protocol_version
        description: The latest_protocol_version taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: next_bp_hash
        description: The next_bp_hash taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: next_epoch_id
        description: The next_epoch_id taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: outcome_root
        description: The outcome_root taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: prev_hash
        description: The prev_hash taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: prev_height
        description: The prev_height taken from block headers.
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: prev_state_root
        description: The prev_state_root taken from block headers. TODO can this be null?
        tests:
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: random_value
        description: The random_value taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: rent_paid
        description: The rent_paid taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: signature
        description: The signature taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - STRING
                - VARCHAR

      - name: total_supply
        description: The total_supply taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: validator_proposals
        description: The validator_proposals taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - ARRAY

      - name: validator_reward
        description: The validator_reward taken from block headers.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - NUMBER

      - name: ingested_at
        description: The timestamp for when the block was ingested.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - TIMESTAMP_NTZ
